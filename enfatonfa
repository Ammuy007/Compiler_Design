#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#define MAX 20
char symbols[MAX];
int transitions[MAX][MAX][MAX];
int epsilon[MAX][MAX];
int epsilonclosure[MAX][MAX];
int closure_count[MAX];
int n,m;
void addtoclosure(int state,int s){
        if(!epsilonclosure[state][s]){
                epsilonclosure[state][s]=1;
                for(int t=0;t<n;t++){
                        if(epsilon[s][t]){
                                addtoclosure(state,t);
                        }
                }
        }
}
void computeepsilonclosure(){
        for(int i=0;i<n;i++){
                memset(epsilonclosure[i],0,sizeof(epsilonclosure[i]));
                addtoclosure(i,i);
        }
}
int main(){
        printf("Enter the number of states\n");
        scanf("%d",&n);
        printf("Enter the number of input symbols\n");
        scanf("%d",&m);
        printf("Enter the input symbols\n");
        for(int i=0;i<m;i++){
                scanf(" %c",&symbols[i]);
        }
        memset(transitions,0,sizeof(transitions));
        memset(epsilon,0,sizeof(epsilon));
        for(int i=0;i<n;i++){
                for(int j=0;j<m;j++){
                        printf("From state q%d for symbol %c enter the number of states\n",i,symbols[j]);
                        int num=0;
                        scanf("%d",&num);
                        if(num){
                                printf("Enter the transitions states(only numbers)\n");
                        }
                        for(int k=0;k<num;k++){
                                int s;
                                scanf("%d",&s);
                                transitions[i][j][s]=1;
                        }
                }
        }
        printf("Enter the epsilon transitions\n");
        while(1){
                int a,b;
                scanf("%d %d",&a,&b);
                if(a==-1 && b==-1){
                        break;
                }
                epsilon[a][b]=1;
        }
        computeepsilonclosure();
        printf("Equivalent NFA without E moves\n");
        for(int i=0;i<n;i++){
                for(int j=0;j<m;j++){
                        int result[MAX]={0};
                        for(int k=0;k<n;k++){
                                if(epsilonclosure[i][k]){
                                        for(int l=0;l<n;l++){
                                                if(transitions[k][j][l]){
                                                        for(int p=0;p<n;p++){
                                                                if(epsilonclosure[l][p]){
                                                                        result[p]=1;
                                                                }
                                                        }
                                                }
                                        }
                                }
                        }
                        printf("From state q%d for symbol %c={",i,symbols[j]);
                        for(int x=0;x<n;x++){
                                if(result[x]){
                                        printf("q%d ",x);
                                }
                        }
                        printf("}\n");
                }
        }
}
